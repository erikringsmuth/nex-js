<h2>Full site example</h2>

<p>This site is built on <a href="http://requirejs.org/">RequireJS</a>, <a href="https://github.com/erikringsmuth/nex-js">nex-js</a>, and the <a href="https://github.com/erikringsmuth/requirejs-router">RequireJS Router</a>. The site's source is available in the <a href="https://github.com/erikringsmuth/nex-js/tree/gh-pages">gh-pages branch</a> of nex-js. This is a great example of a full site setup. Dependencies are installed using <a href="http://bower.io/">Bower</a>.</p>

<h2>Site Setup</h2>

<p>This is a summary of a full site setup. It demonstrates the use of RequireJS, the RequireJS router, and Nex views.</p>

<p class="spacer">Directory layout - The site should be structured so that each page and widget gets its own folder under <code>/js</code>. This keeps related files together.</p>

<pre>├── index.html
├── bower_components/
│   └── // external dependencies
└── js/
    ├── main.js
    ├── layout/
    │   ├── layoutView.js
    │   └── layoutTemplate.html
    ├── home/
    │   ├── homeView.js
    │   └── homeTemplate.js
    └── // other widets and views</pre>

<p class="spacer">Execution order</p> 

<ul>
  <li><code>index.html</code> loads <code>require.js</code></li>
  <li><code>require.js</code> looks at the <code>data-main</code> attribute and loads <code>main.js</code></li>
  <li><code>main.js</code> configures <code>require.js</code> and the <code>requirejs-router</code></li>
  <li>The <code>requirejs-router</code> loads the current route <code>/</code> which gets <code>homeView.js</code></li>
  <li><code>homeView.js</code> uses <code>layoutView.js</code> as it's layout</li>
  <li>The home view and layout are rendered and attached to the document in the router's <code>routeLoadedCallback()</code></li>
</ul>

<p class="spacer"><code>/index.html</code> - loaded when you route to <code>/</code> or any hash route starting with <code>#/</code> or <code>#!/</code></p> 

<pre>&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;nex-js&lt;/title&gt;
    &lt;script data-main="js/main" src="bower_components/require/require.js"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;&lt;/body&gt;
&lt;/html&gt;</pre>

<p class="spacer"><code>/js/main.js</code> - the Javascript entry point to the app</p>

<pre>define([], function() {
  'use strict';

  // Configure require.js paths and shims
  require.config({
    baseUrl: '..', // main.js is in `/js` but we want the baseUrl to be `/`
    paths: {
      'text': 'bower_components/requirejs-text/text',
      'router': 'bower_components/requirejs-router/router',
      'nex': 'bower_components/nex-js/nex',
      'handlebars': 'bower_components/handlebars/handlebars'
    },
    shim: {
      'handlebars': { exports: 'Handlebars' }
    }
  });

  // Load the router
  require(['router'], function(router) {
    // Configure the router
    router.config({
      routes: {
        home: {path: '/', module: 'js/home/homeView'},
        example: {path: '/examples', module: 'js/examples/examplesView'},
        notFound: {path: '*', module: 'js/notFound/NotFoundView'}
      },

      // When a route loads, render the view and attach it to the document
      routeLoadedCallback: function routeLoadedCallback(View) {
        var body = document.querySelector('body');
        body.innerHTML = '';
        body.appendChild(new View().render().outerEl);
      }
    });

    // Trigger the initial page load
    router.loadCurrentRoute();
  });
});</pre>

<p class="spacer"><code>/js/layout/layoutView.js</code> - your site's layout</p>

<pre>define([
  'nex',
  'handlebars',
  'text!./layoutTemplate.html',
  'router'
], function(Nex, Handlebars, layoutTemplate, router) {
  'use strict';

  return Nex.View.extend({
    template: Handlebars.compile(layoutTemplate),
    model: {routes: router.routes},
    contentPlaceholderId: 'content'
  });
});</pre>

<p class="spacer"><code>/js/layout/layoutTemplate.html</code> - the layout HTML</p>

<pre>&lt;header&gt;
  &lt;ul class="navbar"&gt;
    &lt;li \{{#if model.routes.home.matchesUrl}}class="active"\{{/if}}&gt;&lt;a href="#/"&gt;Home&lt;/a&gt;&lt;/li&gt;
    &lt;li \{{#if model.routes.examples.matchesUrl}}class="active"\{{/if}}&gt;&lt;a href="#/examples"&gt;Examples&lt;/a&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/header&gt;
&lt;main id="content"&gt;
&lt;/main&gt;</pre>

<p class="spacer"><code>/js/home/homeView.js</code> - the AMD module loaded for the home route <code>/</code></p>

<pre>define([
  'nex',
  'handlebars',
  'text!./homeTemplate.html',
  'js/layout/layoutView'
], function(Nex, Handlebars, homeTemplate, LayoutView) {
  'use strict';

  return Nex.View.extend({
    template: Handlebars.compile(homeTemplate),
    layoutView: new LayoutView()
  });
});</pre>

<p class="spacer"><code>/js/home/homeTemplate.html</code> - the HTML for the home route <code>/</code></p>

<pre>&lt;h1&gt;Powerful, modular, AMD compatible views.&lt;/h1&gt;</pre>
